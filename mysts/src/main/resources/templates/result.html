<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://code.jquery.com/jquery-3.6.1.js"></script>
    <script type="text/javascript" th:inline="javascript">
        $(function () {
            $("input[type=button]").click(function () {
                var pred_titles = $(".titles");

                var pred_title1 = pred_titles.eq(0).text().trim();
                var pred_title2 = pred_titles.eq(1).text().trim();
                var pred_title3 = pred_titles.eq(2).text().trim();
                var true_title = $('select[name=true_title] option:selected').val();

                console.log(pred_title1, pred_title2, pred_title3, true_title);
                // ì´ë¯¸ì§€ë¥¼ ì„œë²„ë¡œ ì—…ë¡œë“œ
                //var previewImage = document.getElementById('previewImage');
                // ì´ë¯¸ì§€ URLì—ì„œ base64 ë°ì´í„° ì¶”ì¶œ
                //var base64Data = previewImage.src.trim();
               // console.log(previewImage.src.split(',')[0],':',base64Data);
                // base64 ë°ì´í„°ë¥¼ Blobìœ¼ë¡œ ë³€í™˜
                //var file = b64toFile(base64Data, 'image/png');

                // FormData ê°ì²´ ìƒì„±

                var formData = new FormData();
                //formData.append('file',file);
                formData.append('imageId',[[${imageId}]]);
                formData.append('predTitle1', pred_title1); // ì˜ˆì¸¡ ì œëª© 1
                formData.append('predTitle2', pred_title2); // ì˜ˆì¸¡ ì œëª© 2
                formData.append('predTitle3', pred_title3); // ì˜ˆì¸¡ ì œëª© 3
                formData.append('trueTitle', true_title); // ì‹¤ì œ ì œëª©

                // Ajaxë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ë¡œ ì „ì†¡
                $("input[type=button]").prop("disabled", true);
                $.ajax({
                    url: "http://localhost:8080/updateImage",
                    async: true,
                    type: "POST",
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        console.log('Image uploaded successfully:', response);
                        $("input[type=button]").prop("disabled", false);
                    },
                    error: function (xhr, status, error) {
                        console.error('Error uploading image:', error);
                    }
                });
            });
        });


        // base64ë¥¼ Fileë¡œ ë³€í™˜í•´ì£¼ëŠ” í•¨ìˆ˜
        function b64toFile(base_data, contentType = '', sliceSize = 512) {
            const image_data = base_data.split(',')[1]; // data:image/gif;base64 í•„ìš”ì—†ìœ¼ë‹ˆ ë–¼ì£¼ê³ , base64 ì¸ì½”ë”©ì„ í’€ì–´ì¤€ë‹¤
            return new File([image_data], 'image.png', {type:contentType});
        }
        //ì¶œì²˜: https://inpa.tistory.com/entry/JS-ğŸ“š-Base64-Blob-ArrayBuffer-File-ë‹¤ë£¨ê¸°-ì •ë§-ì´í•´í•˜ê¸°-ì‰½ê²Œ-ì„¤ëª…#base64_â†’_arraybuffer_â†’_blob [Inpa Dev ğŸ‘¨â€ğŸ’»:í‹°ìŠ¤í† ë¦¬]
    </script>
</head>
<body>
<h1> ìš”ì²­ ê²°ê³¼ </h1>
íŒŒë¼ë¯¸í„° : <span th:if="${reqResult !=null}" th:text="${reqResult.param}"></span>

</p>
<img id="previewImage" th:if="${reqResult !=null}" th:src="'data:image/png;base64,'+${reqResult[file]}"></p>
<form>
    <!--<input type="file" th:src="'data:image/png;base64,'+${reqResult[file]}">-->
</form>
<br><br>
<!--<h3> from DB </h3>-->
<!--<img th:if="${reqResult !=null}" th:src="'data:image/png;base64,'+${imgSrc}"></p>-->

<table border="1">
    <tr>
        <th>ì£¼ì¸ê³µ</th>
        <th>ê°ë…</th>
        <th>ì¥ë¥´</th>
        <th>post_url</th>
        <th>ê°œë´‰ì¼</th>
        <th>ìœ ì‚¬ë„</th>
        <th>ì œ ëª©</th>
        <th>train_url</th>
    </tr>
    <tr th:if="${reqResult == null}">
        <td colspan="8">í•´ë‹¹í•˜ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
    </tr>

   <tr th:unless="${reqResult == null}"
            th:each="movies, movieStat :${reqResult?.result_list}">

       <td th:text="${movies.movie_info.actors}"></td>
       <td th:text="${movies.movie_info.director}"></td>
       <td th:text="${movies.movie_info.genres}"></td>
       <td th:text="${movies.movie_info.poster_url}"></td>
       <td th:text="${movies.movie_info.release_date}"></td>
       <td th:text="${movies.movie_info.similarity}"></td>
       <td class="titles" th:text="${movies.movie_info.title}" th:attr="data-idx=${movieStat.count}"></td>
       <td th:text="${movies.movie_info.trailer_url}"></td>
   </tr>
</table>
</br>

<select id="true_title" name="true_title">
    <option value="1">ì œëª© 1</option>
    <option value="2">ì œëª© 2</option>
    <option value="3">ì œëª© 3</option>
    <option value="4">í•´ë‹¹ì—†ìŒ</option>
</select>

<input type="button">ì²´í¬</input>
</body>d
</html>